<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>叫貨明細</title>
<style>
:root{--border:#e5e7eb;--muted:#6b7280;--text:#111827;}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif;color:var(--text);background:#f8fafc}
.wrap{max-width:840px;margin:48px auto;padding:0 16px}
.card{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:28px}
h1{margin:0 0 20px;text-align:center;letter-spacing:.12em;font-weight:800;font-size:28px}
.hint{color:var(--muted);margin:0 0 14px}
.table{width:100%;border-collapse:collapse;table-layout:fixed;border:1px solid var(--border);border-radius:8px;overflow:hidden;background:#fff}
.table th,.table td{border-bottom:1px solid var(--border);padding:14px 16px;vertical-align:top;word-break:break-word}
.table th{width:28%;background:#f9fafb;text-align:left;color:#111827;font-weight:700}
.muted{color:var(--muted)}
.prewrap{white-space:pre-wrap}
.footline{margin-top:14px;border-left:4px solid #3b82f6;padding-left:10px;color:var(--muted)}
.ok{color:#059669}.bad{color:#b91c1c}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>叫貨明細</h1>
    <p class="hint">以下為本次訂單資訊：</p>
    <table class="table">
      <tbody>
        <tr><th>訂單時間</th><td id="order_time"     class="muted">（空）</td></tr>
        <tr><th>訂單編號</th><td id="order_id"       class="muted">（空）</td></tr>
        <tr><th>信箱</th><td     id="email"          class="muted">（空）</td></tr>
        <tr><th>分店名稱</th><td id="store_name"     class="muted">（空）</td></tr>
        <tr><th>寄貨方式</th><td id="delivery_method"class="muted">（空）</td></tr>
        <tr><th>取貨備註</th><td id="pickup_note"    class="muted">（空）</td></tr>
        <tr><th>商品明細</th><td id="orders"         class="muted prewrap">（空）</td></tr>
        <tr><th>實際運費</th><td id="shipping_fee"   class="muted">（空）</td></tr>
        <tr><th>總計金額</th><td id="total_amount"   class="muted">（空）</td></tr>
      </tbody>
    </table>
    <p id="resultLine" class="footline">正在將通知送出總部…</p>
  </div>
</div>

<script>
const MAKE_WEBHOOK_URL = "https://hook.eu2.make.com/mxd447qyeae62is1m1vsutndp3bqhudf";
const zhLabelToId = {
  "訂單時間": "order_time",
  "訂單編號": "order_id",
  "信箱": "email",
  "分店名稱": "store_name",
  "寄貨方式": "delivery_method",
  "取貨備註": "pickup_note",
  "商品明細": "orders",
  "實際運費": "shipping_fee",
  "總計金額": "total_amount"
};

function decode(s){ try{return decodeURIComponent((s||'').replace(/\+/g,' '));}catch{return s||'';} }

function parseReversedParams(){
  const params = {};
  const usp = new URLSearchParams(location.search.slice(1));
  usp.forEach((label,value)=>{
    const key = decode(label).trim();       // 左邊是值
    const labelDecoded = decode(value).trim(); // 右邊是欄位名
    const id = zhLabelToId[labelDecoded];
    if(id) params[id] = key;
  });
  return params;
}

function setCell(id, val){
  const el = document.getElementById(id);
  el.textContent = val || '（空）';
  el.classList.toggle('muted', !val);
}

async function postToMake(data){
  try{
    await fetch(MAKE_WEBHOOK_URL, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({__emailjs__: data})
    });
    document.getElementById("resultLine").innerHTML = '✅ <span class="ok">成功</span>寄通知給總部';
  }catch{
    document.getElementById("resultLine").innerHTML = '❌ <span class="bad">失敗</span>寄通知給總部';
  }
}

(function init(){
  const data = parseReversedParams();
  // 顯示在表格
  for(const id in zhLabelToId){
    const elId = zhLabelToId[id];
    setCell(elId, data[elId]);
  }
  // 背景送到 Make
  postToMake(data);
})();
</script>
</body>
</html>
