<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>叫貨明細</title>
<style>
:root{--border:#e5e7eb;--muted:#6b7280;--text:#111827;--ok:#059669;--bad:#b91c1c;--brand:#3b82f6;--bg:#f8fafc;--surface:#fff}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif;
  color:var(--text);background:var(--bg);
  -webkit-tap-highlight-color:transparent;
  padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom)
}
.wrap{max-width:840px;margin:32px auto;padding:0 12px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:20px}
h1{margin:0 0 14px;text-align:center;letter-spacing:.08em;font-weight:800;font-size:22px}
.hint{color:var(--muted);margin:0 0 12px;font-size:14px}

/* 表格樣式 */
.table{width:100%;border-collapse:collapse;table-layout:auto;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--surface)}
.table tbody tr{display:block;border-bottom:1px solid var(--border);padding:10px 12px}
.table tbody tr:last-child{border-bottom:0}
.table th,.table td{display:block;padding:0;vertical-align:top;word-break:break-word}
.table th{margin:0 0 6px;color:#111827;font-weight:700;font-size:13px}
.table td{font-size:15px;line-height:1.6}
.muted{color:var(--muted)}
.prewrap{white-space:pre-wrap; overflow-wrap:anywhere; word-break:break-word;}

/* 商品明細條列（數字清單） */
.orders-list{
  margin: 0;
  padding-left: 1.5em;
  list-style: decimal;
  list-style-position: outside;
}
.orders-list li{
  margin: 3px 0;
  line-height: 1.6;
  text-align: left;
}

/* 手機：整體置中 */
@media (max-width: 480px){
  .card{margin-left:auto;margin-right:auto;}
  .table th,.table td{ text-align:center; }
  .table td .orders-list{ display:inline-block; text-align:left; }
}

@media (min-width:640px){
  .wrap{margin:48px auto;padding:0 16px}
  .card{padding:28px}
  h1{font-size:28px}
  .table{table-layout:fixed}
  .table tbody tr{display:table-row;padding:0}
  .table th,.table td{display:table-cell;padding:14px 16px;border-bottom:1px solid var(--border)}
  .table th{width:28%;background:#f9fafb}
  .table tbody tr:last-child th,.table tbody tr:last-child td{border-bottom:0}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>叫貨明細</h1>
    <p class="hint">以下為本次訂單資訊：</p>

    <!-- 訂單明細表格 -->
    <table class="table">
      <tbody>
        <tr><th>訂單時間</th><td id="order_time"     class="muted">（空）</td></tr>
        <tr><th>訂單編號</th><td id="order_id"       class="muted">（空）</td></tr>
        <tr><th>信箱</th><td     id="email"          class="muted">（空）</td></tr>
        <tr><th>分店名稱</th><td id="store_name"     class="muted">（空）</td></tr>
        <tr><th>寄貨方式</th><td id="delivery_method"class="muted">（空）</td></tr>
        <tr><th>取貨備註</th><td id="pickup_note"    class="muted">（空）</td></tr>
        <tr><th>商品明細</th><td id="orders"         class="muted prewrap">（空）</td></tr>
        <tr><th>實際運費</th><td id="shipping_fee"   class="muted">（空）</td></tr>
        <tr><th>總計金額</th><td id="total_amount"   class="muted">（空）</td></tr>
      </tbody>
    </table>

    <p id="resultLine" class="hint">正在檢查必要欄位…</p>
    <button id="btnSendLast5" class="btn" type="button">上傳後五碼（開啟 LINE）</button>
  </div>
</div>

<script>
// 安全轉義
function escapeHTML(s){
  return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

// 解析「品名 × 數量（標籤）」格式
function parseOrders(raw){
  const t = String(raw||'').replace(/\s+/g,' ').trim();
  const items = [];
  const re = /([^×\n]+?)\s*×\s*(\d+)(?:\s*[（(]\s*([^（）)]+?)\s*[）)])?/g;
  let m;
  while ((m = re.exec(t))) {
    items.push({ name:m[1].trim(), qty:m[2].trim(), tag:(m[3]||'').trim() });
  }
  if (items.length===0 && t) items.push({name:t,qty:'',tag:''});
  return items;
}

// 畫面 HTML：數字清單，標籤在左
function formatOrdersHTML(raw){
  const items=parseOrders(raw);
  return `<ol class="orders-list">` + 
    items.map(it=>{
      const tag=it.tag?`（${escapeHTML(it.tag)}）`:'';
      return `<li>${tag}${escapeHTML(it.name)} × ${escapeHTML(it.qty)}</li>`;
    }).join('') + `</ol>`;
}

// LINE 複製用：數字條列，清楚分段
function formatOrdersText(raw){
  const items=parseOrders(raw);
  return items.map((it,i)=>{
    const tag=it.tag?`（${it.tag}）`:'';
    return `${i+1}. ${tag}${it.name} × ${it.qty}`;
  }).join('\n');
}

// 建立 LINE 訊息
function buildLineText(std){
  const ordersBlock=formatOrdersText(std.orders||'');
  const lines=[
    '【匯款後五碼回報】',
    `訂單時間：${std.order_time||''}`,
    `訂單編號：${std.order_id||''}`,
    `分店名稱：${std.store_name||''}`,
    `信箱：${std.email||''}`,
    `寄貨方式：${std.delivery_method||''}`,
    `取貨備註：${std.pickup_note||''}`,
    '商品明細：',
    ordersBlock,
    '',
    `實際運費：${std.shipping_fee||''}`,
    `總計金額：${std.total_amount||''}`,
    '匯款後五碼：'
  ];
  return lines.join('\n');
}

// 設定表格資料（demo：直接帶假資料）
(function init(){
  const std={
    order_time:'2025年8月19日 上午1:14',
    order_id:'3e198b45-9e35-45d2-995e-e5d8e44dcb7b',
    email:'s9000721@gmail.com',
    store_name:'小洋',
    delivery_method:'宅配',
    pickup_note:'',
    orders:'香濃奶茶粉 × 3 (整件) 啃酥專用粉 × 1 (單品項) 啃酥炸鮮奶 × 10',
    shipping_fee:'$350',
    total_amount:'$6,880'
  };

  document.getElementById('order_time').textContent=std.order_time;
  document.getElementById('order_id').textContent=std.order_id;
  document.getElementById('email').textContent=std.email;
  document.getElementById('store_name').textContent=std.store_name;
  document.getElementById('delivery_method').textContent=std.delivery_method;
  document.getElementById('pickup_note').textContent=std.pickup_note||'（空）';
  document.getElementById('shipping_fee').textContent=std.shipping_fee;
  document.getElementById('total_amount').textContent=std.total_amount;

  // 商品明細改成數字清單
  document.getElementById('orders').innerHTML=formatOrdersHTML(std.orders);

  // 按鈕事件
  document.getElementById('btnSendLast5').addEventListener('click', async ()=>{
    const text=buildLineText(std);
    try{ await navigator.clipboard.writeText(text); alert('已複製訂單明細，可貼到 LINE！'); }
    catch{ alert('複製失敗，請手動複製。'); }
  });
})();
</script>
</body>
</html>
