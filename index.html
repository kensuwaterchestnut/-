<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>訂單已送出（中繼頁）</title>
  <style>
    :root { --w: 1080px; }
    body { font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif; margin: 0; background:#f7f7f8; color:#111; }
    .wrap { max-width: var(--w); margin: 48px auto; padding: 0 20px; }
    h1 { font-size: 22px; margin: 0 0 20px; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow: 0 2px 6px rgba(0,0,0,.04); }
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { padding: 12px 14px; border-top:1px solid #f0f0f0; vertical-align: top; }
    .table tr:first-child th, .table tr:first-child td { border-top: none; }
    .table th { width: 200px; text-align: right; color:#555; font-weight: 600; background:#fafafa; }
    .table td { text-align: left; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .ok { display:inline-block; padding:6px 10px; border-radius:8px; background:#eefaf0; color:#116b2f; font-weight:600; font-size:13px; }
    .foot { margin-top: 14px; font-size: 12px; color:#666; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>訂單已送出 <span class="ok">已通知總部（Make）</span></h1>

    <div class="card">
      <table class="table" id="orderTable">
        <tbody>
          <tr><th>訂單時間</th><td id="order_time" class="mono"></td></tr>
          <tr><th>訂單編號</th><td id="order_id" class="mono"></td></tr>
          <tr><th>信箱</th><td id="email" class="mono"></td></tr>
          <tr><th>分店名稱</th><td id="store_name" class="mono"></td></tr>
          <tr><th>寄貨方式</th><td id="delivery_method" class="mono"></td></tr>
          <tr><th>取貨備註</th><td id="pickup_note" class="mono"></td></tr>
          <tr><th>商品明細</th><td id="order_details" class="mono"></td></tr>
          <tr><th>實際運費</th><td id="shipping" class="mono"></td></tr>
          <tr><th>總計金額</th><td id="total" class="mono"></td></tr>
        </tbody>
      </table>
    </div>

    <div class="foot">若 Make 的 History 沒出現新紀錄，請再次確認此頁 URL 參數是否帶齊。</div>
  </div>

  <script>
    (function () {
      // 1) 讀取網址參數
      const q = new URLSearchParams(location.search);

      // 欄位鍵名（保持與來源一致）
      const fields = [
        'order_time',       // 訂單時間
        'order_id',         // 訂單編號
        'email',            // 信箱
        'store_name',       // 分店名稱
        'delivery_method',  // 寄貨方式
        'pickup_note',      // 取貨備註
        'order_details',    // 商品明細
        'shipping',         // 實際運費
        'total'             // 總計金額
      ];

      // 2) 顯示在頁面上（沒有值則顯示 —）
      fields.forEach(key => {
        const el = document.getElementById(key);
        if (el) el.textContent = q.get(key) || '—';
      });

      // 3) 準備要送到 Make 的同份資料
      const payload = new URLSearchParams();
      fields.forEach(key => payload.append(key, q.get(key) || ''));
      payload.append('_ts', Date.now().toString()); // 防快取/去重

      // 4) 以圖片 beacon 方式送到 Make Webhook（隱藏、不受 CORS 影響）
      const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/mxd447qyeae62is1m1vsutndp3bqhudf';
      const img = new Image();
      img.src = MAKE_WEBHOOK_URL + '?' + payload.toString();
      img.onload = () => console.log('Make webhook ping sent.');
      img.onerror = () => console.warn('Make webhook ping failed. 檢查 URL 或網路。');
    })();
  </script>
</body>
</html>
