<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>叫貨明細</title>
  <style>
    :root{--border:#e5e7eb;--muted:#6b7280;--text:#111827;--ok:#059669;--bad:#b91c1c;--brand:#3b82f6;--bg:#f8fafc;--surface:#fff}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif;color:var(--text);background:var(--bg);-webkit-tap-highlight-color:transparent;padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom)}
    .wrap{max-width:840px;margin:32px auto;padding:0 12px}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:20px}
    h1{margin:0 0 14px;text-align:center;letter-spacing:.08em;font-weight:800;font-size:22px}
    .hint{color:var(--muted);margin:0 0 12px;font-size:14px}
    .table{width:100%;border-collapse:collapse;table-layout:auto;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--surface)}
    .table tbody tr{display:block;border-bottom:1px solid var(--border);padding:10px 12px}
    .table tbody tr:last-child{border-bottom:0}
    .table th,.table td{display:block;padding:0;vertical-align:top;word-break:break-word}
    .table th{margin:0 0 6px;color:#111827;font-weight:700;font-size:13px}
    .table td{font-size:15px;line-height:1.6}
    .muted{color:var(--muted)}
    .prewrap{white-space:pre-wrap}
    .footline{margin-top:12px;border-left:4px solid var(--brand);padding:10px 12px;color:var(--muted);border-radius:8px;background:#f8fbff;font-size:14px}
    .ok{color:var(--ok)}.bad{color:var(--bad)}
    .notice{margin-top:16px;background:#f0f9ff;border:1px solid #dbeafe;border-radius:12px;padding:14px}
    .warn{background:#fff7ed;border-color:#ffedd5}
    .small{font-size:14px}
    .bank{margin-top:12px}
    .kv{display:flex;align-items:center;justify-content:space-between;gap:8px;background:#f9fafb;border:1px solid var(--border);padding:12px;border-radius:12px}
    .btn{cursor:pointer;border:1px solid var(--border);background:#fff;border-radius:10px;padding:10px 14px;font-size:15px;touch-action:manipulation;min-width:120px}
    .btn-line{background:#06c755;border-color:#06c755;color:#fff}
    .sticky-actions{position:sticky;top:0;z-index:30;margin:12px -10px 0;padding:10px;background:#ffffffF2;backdrop-filter:blur(6px);border:1px solid var(--border);border-left:0;border-right:0;display:flex;gap:10px;flex-wrap:wrap;}
    .sticky-actions .btn{flex:1}
    .toast{margin-top:12px;padding:10px 14px;border-radius:8px;font-size:14px;display:none}
    .toast.show{display:block}
    .toast.success{background:#ecfdf5;border:1px solid #10b981;color:#065f46}
    .toast.loading{background:#eef2ff;border:1px solid #6366f1;color:#3730a3}
    .toast.error{background:#fef2f2;border:1px solid #f87171;color:#991b1b}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>叫貨明細</h1>
      <p class="hint">以下為本次訂單資訊：</p>
      <div class="notice bank">
        <h3>匯款資訊</h3>
        <div class="row">
          <div class="kv"><b>銀行代號</b><span id="bank_code_txt">824（連線銀行）</span></div>
          <div class="kv"><b>銀行帳號</b><span id="bank_acct_txt" style="font-variant-numeric:tabular-nums">111013782313</span>
            <button id="copyBtn" class="btn" type="button">複製帳號</button>
          </div>
        </div>
        <ul class="small" style="margin:10px 0 0 18px;line-height:1.7">
          <li>下單後，<b>收到款項</b>進行出貨（約 <b>3–5 個工作天</b>）。</li>
          <li>如需開立發票/收據，需加收<b>營業稅 5%</b>。</li>
          <li>匯款後請提供<b>後五碼</b>傳送至總部官方帳號。</li>
        </ul>
      </div>
      <div class="sticky-actions">
        <button id="btnSendLast5" class="btn btn-line" type="button">上傳後五碼（開啟 LINE）</button>
      </div>
      <div id="toast" class="toast"></div>
      <p id="resultLine" class="footline">正在檢查必要欄位…</p>
      <table class="table">
        <tbody>
          <tr><th>訂單時間</th><td id="order_time" class="muted">（空）</td></tr>
          <tr><th>訂單編號</th><td id="order_id" class="muted">（空）</td></tr>
          <tr><th>信箱</th><td id="email" class="muted">（空）</td></tr>
          <tr><th>分店名稱</th><td id="store_name" class="muted">（空）</td></tr>
          <tr><th>寄貨方式</th><td id="delivery_method" class="muted">（空）</td></tr>
          <tr><th>取貨備註</th><td id="pickup_note" class="muted">（空）</td></tr>
          <tr><th>商品明細</th><td id="orders" class="muted prewrap">（空）</td></tr>
          <tr><th>實際運費</th><td id="shipping_fee" class="muted">（空）</td></tr>
          <tr><th>總計金額</th><td id="total_amount" class="muted">（空）</td></tr>
        </tbody>
      </table>
    </div>
  </div>
<script>
const LINE_OA_ID = "@185jccqz";
function showToast(type, msg){
  const toast = document.getElementById('toast');
  toast.className = `toast show ${type}`;
  toast.textContent = msg;
  setTimeout(() => toast.classList.remove('show'), 4000);
}
function setCell(id,val){
  const el=document.getElementById(id);
  const v=(val==null||val==='')?'（空）':String(val);
  el.textContent=v; el.classList.toggle('muted',v==='（空）');
}
function readParams(){
  const map={}, usp=new URLSearchParams(location.search);
  usp.forEach((v,k)=> map[k.trim()] = v.trim());
  return map;
}
function buildMsg(p,last5){
  const parts=['【匯款後五碼回報】'];
  if(p['order_id']) parts.push('訂單編號：'+p['order_id']);
  if(p['store_name']) parts.push('分店：'+p['store_name']);
  if(p['total']) parts.push('總金額：'+p['total']);
  parts.push('匯款後五碼：'+last5);
  return parts.join('\n');
}
async function handleSendLast5(p){
  let last5 = prompt('請輸入匯款後五碼：',''); if(!last5) return;
  last5 = String(last5).trim();
  if(!/^\d{5}$/.test(last5)){ showToast('error','格式錯誤，請輸入 5 位數字'); return; }
  const msg = buildMsg(p, last5);
  try{ await navigator.clipboard.writeText(msg); showToast('success','✅ 已複製訊息'); }
  catch{ showToast('error','❌ 複製失敗，請手動複製'); }
  showToast('loading','🚀 正在跳轉至 LINE...');
  const link = `https://line.me/R/oaMessage/${LINE_OA_ID}/?${encodeURIComponent(msg)}`;
  setTimeout(() => { window.location.href = link; }, 2000);
}
(function init(){
  const p = readParams();
  setCell('order_time', p['order_time']);
  setCell('order_id', p['order_id']);
  setCell('email', p['email']);
  setCell('store_name', p['store_name']);
  setCell('delivery_method', p['delivery_method']);
  setCell('pickup_note', p['pickup_note']);
  setCell('orders', p['order_details']);
  setCell('shipping_fee', p['shipping']);
  setCell('total_amount', p['total']);
  document.getElementById('btnSendLast5')?.addEventListener('click', ()=> handleSendLast5(p));
  document.getElementById('copyBtn')?.addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(document.getElementById('bank_acct_txt').textContent.trim());
      showToast('success','📋 已複製帳號');
    }catch{}
  });
})();
</script>
</body>
</html>
